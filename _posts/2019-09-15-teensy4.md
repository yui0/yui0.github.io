---
layout: post
title: ğŸ›  Teensy 4.x ã®é–‹ç™ºç’°å¢ƒã‚’æ•´ãˆã‚‹ (GCC, SEGGER)
tags: [teensy,arm]
---

**å¯¾è±¡**: Teensy 4.x ã‚’ä½¿ã£ãŸé–‹ç™ºã®ãŸã‚ã«ã€GCCã¨SEGGERã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’è¡Œã„ã¾ã™ã€‚
arm-none-eabi-gccã¨ãƒœãƒ¼ãƒ‰ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’æº–å‚™ã™ã‚‹ã€‚

## âœ… å¿…è¦ãªæº–å‚™ (GCC)

1. **ğŸ”Œ å¿…è¦ãªã‚‚ã®**
  - ğŸ–¥ **Teensy 4.x æœ¬ä½“**
  - ğŸ›  **ARMã‚³ãƒ³ãƒ‘ã‚¤ãƒ©**:
    - [GNU Tools for ARM Embedded Processors](https://developer.arm.com/open-source/gnu-toolchain/gnu-rm/downloads) ã‹ã‚‰ **gcc** ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦å±•é–‹ã—ã¾ã™ã€‚
      - https://developer.arm.com/open-source/gnu-toolchain
      - https://developer.arm.com/downloads/-/arm-gnu-toolchain-downloads

```bash
dnf install arm-none-eabi-gcc
dnf install arm-none-eabi-newlib

pushd bin
cp -aus /usr/bin/arm-none-eabi* .
popd
```

  - **è¿½åŠ ä½œæ¥­**: [arm_cortexM7lfsp_math.a](https://github.com/ARM-software/CMSIS/tree/master/CMSIS/Lib/GCC) ã‚’å–å¾—ã—ã€`arm-none-eabi/lib`ã«ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ã€‚

2. **ğŸ“‚ å¿…è¦ãªãƒœãƒ¼ãƒ‰ãƒ©ã‚¤ãƒ–ãƒ©ãƒª**
  - ãã‚Œãã‚Œã®ãƒœãƒ¼ãƒ‰ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€‚
    - Teensyã®å ´åˆã€[PaulStoffregenã®ãƒªãƒã‚¸ãƒˆãƒª](https://github.com/PaulStoffregen/cores/tree/master/teensy4)ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚

3. **ğŸ“œ é–‹ç™ºã®ç°¡ç•¥åŒ–**
  - makeã§é–‹ç™ºã§ãã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ç”¨ã™ã‚‹ã¨æ¥½ã€‚[ã“ã“](https://github.com/yui0/arduino-sdk)ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€‚
    - `tools` ãƒ•ã‚©ãƒ«ãƒ€ã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸ **gcc** ã‚’é…ç½®ã—ã¾ã™ã€‚
    - `src` ãƒ•ã‚©ãƒ«ãƒ€ã« `main.cpp` ã‚’ä½œæˆã—ã¾ã™ã€‚ã‚µãƒ³ãƒ—ãƒ«ã¯ä»¥ä¸‹ã®é€šã‚Šã€‚

```main.cpp
// Â©2017 Yuichiro Nakada

#include "WProgram.h"

void setup()
{
	pinMode(13, OUTPUT);
	analogWriteResolution(8);	// 8bit/Resolution
}

void loop()
{
	if (usb_audio_receive_buffer[0]<0x7fff) digitalWriteFast(13, LOW);
	else digitalWriteFast(13, HIGH);
	analogWrite(9, 50);
}

extern "C" int main()
{
	setup();
	while (1) {
		loop();
		yield();
	}
}
```

## âœ… å¿…è¦ãªæº–å‚™ (SEGGER)

1. **ğŸ”Œ å¿…è¦ãªã‚‚ã®**
   - ğŸ–¥ **Teensy 4.x æœ¬ä½“**
   - ğŸ›  **Embedded Studio for ARM**
     - [ã“ã¡ã‚‰ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰](https://www.segger.com/downloads/embedded-studio)ã—ã¦å±•é–‹ã—ã¾ã™ã€‚
     - å±•é–‹å¾Œã«ä»¥ä¸‹ã‚’å®Ÿè¡Œ:
       ```bash
       ./install_segger_embedded_studio --copy-files-to .
       ```

2. **ğŸ“œ é–‹ç™ºã®ç°¡ç•¥åŒ–**
   - makeã§é–‹ç™ºã§ãã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’æº–å‚™ã€‚[ã“ã“](https://github.com/yui0/arduino-sdk)ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€‚
     - å±•é–‹ã—ãŸ `/bin/segger-cc` ã‚’ `/tools/arm-segger/bin` ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚
     - å±•é–‹ã—ãŸ `/include` ã‚’ `/tools/arm-segger/include` ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚
   - teensy4.miniä»¥ä¸‹ã«main.cã‚’æ›¸ãã€‚ã‚µãƒ³ãƒ—ãƒ«ã¯ä»¥ä¸‹ã®é€šã‚Šã€‚
   - make uploadã‚’å®Ÿè¡Œã€‚

```main.c
// Â©2020 Yuichiro Nakada

#include "WProgram.h"

int main()
{
	pinMode(13, OUTPUT);
	digitalWriteFast(13, HIGH);

	while (1) {
		//Serial.println("Hello World...");
//		usb_seremu_write("Hello World...\n\r", 16);
		digitalWriteFast(13, HIGH);
		delay(500);
		digitalWriteFast(13, LOW);
		delay(500);
	}
}
```

## ğŸ³ Docker ã‚’ä½¿ã£ãŸç’°å¢ƒæ§‹ç¯‰

**ç°¡å˜ãªã‚¹ãƒ†ãƒƒãƒ—ã§ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼**

1. **ğŸ›  Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æº–å‚™ã™ã‚‹**
   ```bash
   $ docker pull berry0/teensy-dev:latest
   $ docker run --net=host -it -d --name teensy-dev berry0/teensy-dev:latest
   $ docker exec -it teensy-dev /bin/bash
   ```

2. **ğŸ“‚ å¿…è¦ãªä½œæ¥­ã‚’å®Ÿè¡Œ**
   ```bash
   # cd /arduino-sdk/teensy/tools/
   # echo "yes" | sh setup_segger.sh
   # cd /arduino-sdk/teensy/teensy4
   # make
   # make upload
   # make clean
   # cd /arduino-sdk/teensy/teensy4.mini
   # make
   # make upload
   # make clean
   ```

3. **ğŸ“– è©³ç´°æƒ…å ±ã¯ã“ã¡ã‚‰**
   - [yui0/arduino-sdk ãƒªãƒã‚¸ãƒˆãƒª](https://github.com/yui0/arduino-sdk)

ğŸ‰ ã“ã‚Œã§ã€Teensy 4.x ã‚’ä½¿ã£ãŸé–‹ç™ºæº–å‚™ã¯å®Œäº†ã§ã™ï¼ Happy Coding! ğŸ˜Š
