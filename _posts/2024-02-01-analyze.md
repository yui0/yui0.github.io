---
layout: post
title: USBプロトコルアナライザをラズパイで作る!
tags: [usb,analyze,raspberry,pi]
---

USBプロトコルアナライザは、なぜか高価なので、Raspberry Pi 4 Model Bにusb-proxyを組み合わせて代用する。

## 必要な物

1. Raspberry Pi 4 Model B
2. OSインストール用のSDカード

## Raspberry Pi 4を使えるようにする

OS: Raspberry Pi OS Lite (64bit) 

```
sudo apt update
sudo apt upgrade -y
sudo apt install git -y
sudo apt install raspberrypi-kernel-headers
```

## OTGポートを利用できるようにする

```
echo "dtoverlay=dwc2" | sudo tee -a /boot/config.txt
echo "dwc2" | sudo tee -a /etc/modules
sudo reboot
```

## raw-gadgetのインストール

```
git clone https://github.com/programmer-princhan/raw-gadget.git
cd raw-gadget/raw_gadget/
make
sudo ./insmod.sh
cd
```

## usb-proxyのインストール

```
git clone https://github.com/AristoChen/usb-proxy.git
cd usb-proxy/
sudo apt install libusb-1.0–0-dev
sudo apt install libjsoncpp-dev
make
```

## usb-proxyの実行

```
cd ~/usb-proxy
sudo ./usb-proxy device=fe980000.usb driver=fe980000.usb vendor_id=0f0d product_id=0185
```
